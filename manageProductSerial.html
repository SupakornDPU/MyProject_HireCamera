<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage ProductSerials</title>
    
    <script src="js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="//cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
    

    <style>
        body {
            padding-top: 55px;
        }
    </style>
</head>

<body class="d-flex flex-column min-vh-100">
    <!-- ! Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <img src="img/camera-logo-download-clipart-24.png" class="bi me-2" width="40px" height="40px" role="img"
                aria-label="Bootstrap"></img>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor01"
                aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarColor01">
                <ul class="navbar-nav me-auto mb-2 px-3 gap-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="index.html"><i class="mx-1 bi bi-house-fill"></i>Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="manageProductSerial.html"><i class="mx-1 bi bi-gear-wide-connected"></i>Manage ProductSerial</a></li>
                    <li class="nav-item"><a class="nav-link" href="manageproduct.html"><i class="mx-1 bi bi-gear-wide-connected"></i>Manage Product</a></li>
                </ul>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                </form>
                <div class="text-end">
                    <a type="button" class="btn btn-outline-light me-2" href="login.html">Login</a>
                    <a type="button" class="btn btn-primary" href="register.html">Sign-up</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- ! Navbar -->

    <div class="container">
        <form id="myForm">
            <div class="row mt-5">
                <div class="col-md-1">
                    <label for="text" class="form-label">หมายเลขผลิตภัณฑ์</label>
                </div>
                <div class="col-md-3">
                    <input class="form-control" type="text" id="productSerialnumber" name="productSerialnumber" placeholder="กรุณากรอกหมายเลขผลิตภัณฑ์">
                </div>

                <div class="col-md-1">
                    <label for="text" class="form-label">ชื่อสินค้า</label>
                </div>
                <div class="col-md-3">
                    <input class="form-control" type="text" id="productName" name="productName" placeholder="กรุณากรอกชื่อสินค้า">
                </div>

                <div class="col-md-1">
                    <label for="text" class="form-label">ราคาสินค้า</label>
                </div>
                <div class="col-md-3">
                    <input class="form-control" type="text" id="productPrice" name="productPrice" placeholder="กรุณากรอกราคาสินค้า">
                </div>

                <div class="d-flex justify-content-center mt-4">
                    <div class="div">
                        <button class="btn btn-info text-white" id="createData" onclick="window.location.reload();">เพิ่มสินค้า</button>
                    </div>
                    <div class="div mx-3">
                        <button class="btn btn-success" id="saveData" onclick="window.location.reload();">บันทึก</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="container ">
        <!-- <div class="input-group mt-3 ">
            <span class="input-group-text" id="basic-addon1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search"
                    viewBox="0 0 16 16">
                    <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z">
                    </path>
                </svg>
            </span>
            <input type="search" class="form-control">
        </div> -->
        <table class="table table-dark table-hover table-striped mb-5 align-middle" id="table-master">
            <thead>
                <tr>
                    <th>หมายเลขผลิตภัณฑ์</th>
                    <th>ชื่อสินค้า</th>
                    <th>ราคาสินค้า</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="tbody">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- !Footer -->
    <footer class="footer text-center text-white mt-auto" style="background-color: #21081a;">
        <!-- Grid container -->
        <div class="container p-4">
            <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button">
                <i class="bi bi-facebook"></i>
            </a>
            <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button">
                <i class="bi bi-line"></i>
            </a>
            <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button">
                <i class="bi bi-instagram"></i>
            </a>
        </div>
        <!-- Grid container -->

        <!-- Copyright -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            © 2020 Copyright:
            <a class="text-white" href="#">Hire Camera</a>
        </div>
        <!-- Copyright -->
    </footer>
    <!-- !Footer -->

    <script>

        // Method : Get ProductSerials
        $(document).ready(() => {
            $.ajax({
                method: 'get',
                url: 'http://localhost:5084/api/Products/ProductSerial',
                success: (response) => {
                    console.log(response)
                    let html = "";
                    for (let i = 0; i < response.length; i++) {
                        const data = response[i];
                        html += `
                            <tr>
                                <td>${data.productSerialnumber}</td>
                                <td>${data.productName}</td>
                                <td>${data.productPrice}</td>
                                <td>
                                    <button type="button" class="btn btn-danger" onclick="deleteDatable('${data.productSerialnumber}')">ลบ</button>
                                    <button class="btn btn-success" onclick="getValue(${data.productSerialnumber},'${data.productName}',${data.productPrice})">แก้ไข</button></td>
                            </tr>`;
                    }
                    document.getElementById("tbody").innerHTML = html;
                    $('#tbody').html(html).promise().done(() => {
                        $('#table-master').DataTable();
                    })
                }
            })
        })
        
        // Method :POST Serialnumber
        let createDataBtn = document.querySelector('#createData');
        createDataBtn.addEventListener('click', function (e) {
            e.preventDefault();

            var productSerialnumber = document.getElementById("productSerialnumber").value;
            var productName = document.getElementById("productName").value;
            var productPrice = document.getElementById("productPrice").value;

            fetch(`http://localhost:5084/api/Products/ProductSerialsPost`, {
                method: 'post',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    "productSerialnumber": productSerialnumber,
                    "productName": productName,
                    "productPrice": productPrice
                })
            }).then(res => res.json())
                .then(data => console.log(data))
                .catch(error => console.log(error));
        });
        
        // Method : Delete
        function deleteDatable(productSerialnumber) {
            if (confirm('คุณต้องการลบข้อมูล ใช่ หรือ ไม่')) {
                
                fetch(`http://localhost:5084/api/Products/DeleteProductSerials?id=${productSerialnumber}`, {
                    method: 'delete',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                }).then(res => res.json())
                    .then(data => console.log(data))
                    .catch(error => console.log(error))
                    window.location.reload();
            }
        }

        function getValue(productSerialnumber,productName,productPrice) {
            document.getElementById("productSerialnumber").value = productSerialnumber;
            document.getElementById("productName").value = productName;
            document.getElementById("productPrice").value = productPrice;
            const scroolToTap = () => {
                window.scroll({
                top: 0,
                behavior: 'smooth'
                });
            };
            scroolToTap();
        }

        // Method : PUT ProductSerials
        let saveDataBtn = document.querySelector('#saveData');
        saveDataBtn.addEventListener('click', function (e) {
            e.preventDefault();
            
            var productSerialnumber = document.getElementById("productSerialnumber").value;
            var productName = document.getElementById("productName").value;
            var productPrice = document.getElementById("productPrice").value;

            fetch(`http://localhost:5084/api/Products/EditProductSerials`, {
                method: 'put',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    "productSerialnumber": productSerialnumber,
                    "productName": productName,
                    "productPrice": productPrice
                })
            }).then(res => res.json())
                .then(data => console.log(data))
                .catch(error => console.log(error))
        });

        // // Delete DATA
        // let deleteDataBtn = document.querySelector('#deleteData');
        // deleteDataBtn.addEventListener('click', function (e) {
        //     e.preventDefault();

        //     var productSerialnumber = document.getElementById("productSerialnumber").value;

        //     fetch(`http://localhost:5084/api/Products/DeleteProductSerials?id=${productSerialnumber}`, {
        //         method: 'delete',
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //     }).then(res => res.json())
        //         .then(data => console.log(data))
        //         .catch(error => console.log(error));
        // });

 // myForm.addEventListener('submit', function (e) {
        //     e.preventDefault();

        //     var productSerialnumber = document.getElementById("productSerialnumber").value;
        //     var productName = document.getElementById("productName").value;
        //     var productPrice = document.getElementById("productPrice").value;

        //     fetch('http://localhost:5084/api/Products/ProductSerialsPost', {
        //         method: 'post',
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //         body: JSON.stringify({
        //             "productSerialnumber": productSerialnumber,
        //             "productName": productName,
        //             "productPrice": productPrice
        //         })
        //     }).then(res => res.json())
        //         .then(data => console.log(data))
        //         .catch(error => console.log(error));
        // });


        // function createData() {
        //     var productSerialnumber = document.getElementById("productSerialnumber").value;
        //     var productName = document.getElementById("productName").value;
        //     var productPrice = document.getElementById("productPrice").value;

        //     fetch('http://localhost:5084/api/Products/ProductSerialsPost', {
        //         method: 'post',
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //         body: JSON.stringify({
        //             "productSerialnumber": productSerialnumber,
        //             "productName": productName,
        //             "productPrice": productPrice
        //         })
        //     }).then(res => res.json())
        //         .then(data => console.log(data))
        //         .catch(error => console.log(error));
        // }
        // let createDataBtn = document.querySelector('#createData');
        // createDataBtn.addEventListener('click', createData);

        
        // function editData() {
        //     var productSerialnumber = document.getElementById("productSerialnumber").value;
        //     var productName = document.getElementById("productName").value;
        //     var productPrice = document.getElementById("productPrice").value;

        //     fetch(`http://localhost:5084/api/Products/EditProductSerial/${productSerialnumber}`, {
        //         method: 'put',
        //         headers: {
        //             'Content-Type': 'application/json',
        //         },
        //         body: JSON.stringify({
        //             "productName": productName,
        //             "productPrice": productPrice
                    
        //         })
        //     }).then(res => res.json())
        //         .then(data => console.log(data))
        //         .catch(error => console.log(error));
        // }
        // let editDataBtn = document.querySelector('#editData');
        // editDataBtn.addEventListener('click', editData);
    </script>
</body>

</html>